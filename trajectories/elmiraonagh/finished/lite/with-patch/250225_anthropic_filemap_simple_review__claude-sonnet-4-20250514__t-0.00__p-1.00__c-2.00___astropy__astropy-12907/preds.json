{
    "astropy__astropy-12907": {
        "model_name_or_path": "250225_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-2.00___astropy__astropy-12907",
        "instance_id": "astropy__astropy-12907",
        "model_patch": "diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py\nindex e180603..36e6fdb 100644\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -232,12 +232,24 @@ def _cstack(left, right):\n     noutp = _compute_n_outputs(left, right)\n \n     if isinstance(left, Model):\n-        cleft = _coord_matrix(left, \"left\", noutp)\n+        if isinstance(left, CompoundModel):\n+            # For CompoundModel, use _separable to get the correct separability matrix\n+            cleft_sep = _separable(left)\n+            cleft = np.zeros((noutp, cleft_sep.shape[1]))\n+            cleft[: cleft_sep.shape[0], : cleft_sep.shape[1]] = cleft_sep\n+        else:\n+            cleft = _coord_matrix(left, \"left\", noutp)\n     else:\n         cleft = np.zeros((noutp, left.shape[1]))\n         cleft[: left.shape[0], : left.shape[1]] = left\n     if isinstance(right, Model):\n-        cright = _coord_matrix(right, \"right\", noutp)\n+        if isinstance(right, CompoundModel):\n+            # For CompoundModel, use _separable to get the correct separability matrix\n+            cright_sep = _separable(right)\n+            cright = np.zeros((noutp, cright_sep.shape[1]))\n+            cright[-cright_sep.shape[0] :, -cright_sep.shape[1] :] = cright_sep\n+        else:\n+            cright = _coord_matrix(right, \"right\", noutp)\n     else:\n         cright = np.zeros((noutp, right.shape[1]))\n         cright[-right.shape[0] :, -right.shape[1] :] = right\n@@ -266,7 +278,11 @@ def _cdot(left, right):\n         Return ``n_inputs``, ``n_outputs`` for a model or coord_matrix.\n         \"\"\"\n         if isinstance(input, Model):\n-            coords = _coord_matrix(input, position, input.n_outputs)\n+            if isinstance(input, CompoundModel):\n+                # For CompoundModel, use _separable to get the correct separability matrix\n+                coords = _separable(input)\n+            else:\n+                coords = _coord_matrix(input, position, input.n_outputs)\n         else:\n             coords = input\n         return coords\n"
    }
}